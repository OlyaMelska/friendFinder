<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Find Friend</title>
    <!--Bootstrap-->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <!--Google Fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Chelsea+Market"
      rel="stylesheet"
    />
    <!--Styles CSS-->
    <link rel="stylesheet" href="style.css" />
    <!--Logo Icon Link-->
    <link
      rel="icon"
      type="image/jpeg"
      href="https://github.com/OlyaMelska/friendFinder/blob/master/app/images/logo.png?raw=true"
    />
    <style>
      body {
        color: #fab942;
        height: 100vh;
        width: 100vw;
        text-align: center;
        font-family: "Chelsea Market", cursive;
      }

      .dropdown-menu {
        color: #fab942;
      }

      input {
        width: 400px;
        color: #703178;
      }

      .dropdown-item:hover {
        background: #fab942;
        color: #fff;
      }

      .header {
        height: 25vh;
        padding-top: 70px;
        font-size: 54px;
      }

      header {
        height: 20%;
        padding-top: 20px;
      }

      h2 {
        margin-top: 20px;
        color: #703178;
        font-size: 22px;
      }

      select {
        padding: 2px;
        background: #fab942;
        color: #703178;
        height: 35px;
        border: 0px;
      }

      select:hover {
        opacity: 0.9;
      }

      .btn-warning {
        background: #fab942;
        color: #703178;
      }

      button:hover {
        color: #703178;
      }

      .main {
        height: 50vh;
        font-size: 18px;
      }

      a {
        text-decoration: none;
        color: #fab942;
      }

      a:hover {
        color: #703178;
        text-decoration: none;
      }

      .absolute {
        position: absolute;
        left: 30px;
      }

      #logo {
        width: 250px;
        height: 250px;
      }

      .margins {
        margin-top: 50px;
      }

      #header-logo {
        width: 100px;
        height: 100px;
      }

      .footer {
        height: 25vh;
        padding-top: 70px;
      }

      footer {
        height: 20%;
        padding-top: 5%;
      }
    </style>
  </head>

  <body>
    <header>
      <img
        src="https://github.com/OlyaMelska/friendFinder/blob/master/app/images/logo.png?raw=true"
        alt="logo"
        id="header-logo"
      />
    </header>
    <main>
      <h2>About You</h2>
      <form>
        <input type="text" placeholder="your name" id="name" />
        <input type="email" placeholder="link to your photo" id="photo" />
      </form>

      <div>
        <h2>Question 1</h2>
        <p>Your mind is always buzzing with unexplored ideas and plans.</p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 2</h2>
        <p>
          Generally speaking, you rely more on your experience than your
          imagination.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 3</h2>
        <p>
          You find it easy to stay relaxed and focused even when there is some
          pressure.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 4</h2>
        <p>You rarely do something just out of sheer curiosity.</p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 5</h2>
        <p>
          People can rarely upset you.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 6</h2>
        <p>
          It is often difficult for you to relate to other people’s feelings.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 7</h2>
        <p>
          In a discussion, truth should be more important than people’s
          sensitivities.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 8</h2>
        <p>
          You rarely get carried away by fantasies and ideas.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 9</h2>
        <p>
          You think that everyone’s views should be respected regardless of
          whether they are supported by facts or not.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>

      <!--New Question-->

      <div>
        <h2>Question 10</h2>
        <p>
          You feel more energetic after spending time with a group of people.
        </p>
        <select class="answers" required>
          <option></option>
          <option value="1">1 (strongly agree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (strongly disagree)</option>
        </select>
      </div>
      <div class="absolute">
        <a href="/api/friends"> API Friends List</a> |
        <a href="https://github.com/OlyaMelska/friendFinder">Git Hub Repo</a>
      </div>
    </main>

    <!--Modal Result-->

    <!-- Button trigger modal -->
    <button
      type="submit"
      class="btn btn-warning margins"
      data-toggle="modal"
      data-target="#exampleModalLong"
      id="submit"
    >
      Find me a friend
    </button>

    <!-- Modal -->
    <div
      class="modal fade "
      id="exampleModalLong"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLongTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">
              Here's your match
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body result-div"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!--footer-->
    <footer>copyright 2019</footer>

    <!--jQuery-->
    <script
      src="https://code.jquery.com/jquery-3.4.0.min.js"
      integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script src="main.js"></script>
    <script>
      let submitBtn = document.getElementById("submit");
      let newFriend = {};
      console.log(submitBtn);
      submitBtn.addEventListener("click", () => {
        event.preventDefault();

        const dropdowns = document.getElementsByClassName("answers");
        const answers = [];

        for (let i = 0; i < 10; i++) {
          console.log(dropdowns[i]);
          const value = dropdowns[i].value;

          answers.push(value);
        }

        let name = document.getElementById("name").value;
        let photo = document.getElementById("photo").value;
        newFriend = {
          name: name,
          photo: photo,
          scores: answers
        };

        $.post("/api/friends", newFriend).then(response => {
          console.log("Response" + response);
        });
        $.get("/api/friends").then(response => {
          let foundFriend = findMatch(response.friends, newFriend);
          console.log("Friend at GER Request ", foundFriend);
          let h2 = $("<h2>");
          let img = $("<img>");
          let imgDiv = $("<div>");
          h2.text(foundFriend.name);
          img.attr("src", foundFriend.url);
          img.addClass("img-fluid");
          imgDiv.append(img);
          $(".result-div").empty();
          $(".result-div").append(h2, imgDiv);
          console.log(
            `your match:\nname: ${foundFriend.name} photo: ${foundFriend.url}`
          );
        });
      });

      let findMatch = (data, currentUser) => {
        //Function that finds a user with the smallest difference in answerder questions
        let arr = []; //to store total diffrences and name
        let totalDifferenceArr = []; //to store just total difference
        let friendResult = ""; //function will return the name
        let totalArr = data.filter(elem => {
          if (elem.name !== currentUser.name) {
            return elem;
          }
        });
        console.log("TOTAL ", totalArr);
        totalArr.forEach(element => {
          let sum = 0;
          let obj = {}; //to save name and total difference for each element of data array
          for (let i = 0; i < element.scores.length; i++) {
            let numb = Math.abs(element.scores[i] - currentUser.scores[i]);
            sum += numb; //calculating an absolute diffrence
            obj = {
              name: element.name,
              url: element.photo,
              totalDifference: sum
            };
          }
          arr.push(obj); //saving names & sums
          totalDifferenceArr.push(sum); //saving just sums
        });

        let result = Math.min.apply(null, totalDifferenceArr); //looking for the smallest value
        arr.forEach(element => {
          if (element.totalDifference === result) {
            friendResult = element;
            console.log("Your friend that you matched to: ", friendResult);
          } else {
            friendResult = "";
          }
        });
        return friendResult;
      };
    </script>
  </body>
</html>
